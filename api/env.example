# ========================================
# Application Configuration
# ========================================

# Port for the NestJS application
# Default: 8002
# PORT=8002

# Domain name for cookie domain and application URL derivation
# The full application URL (e.g., https://meriter.pro) is automatically derived from this
# Application URL is derived as: https://{DOMAIN} (or http:// for localhost)
# Cookie domain is set to DOMAIN directly (undefined for localhost)
# Use localhost for local development
# For production: set to your domain (e.g., meriter.pro)
# This is typically set in the root .env file and passed to the API service
DOMAIN=meriter.pro

# ========================================
# Security Configuration (SENSITIVE)
# ========================================

# JWT Secret for token signing and verification (REQUIRED in production)
# SECURITY WARNING: This is a CRITICAL security credential
# - Use a strong, randomly generated secret (minimum 32 characters)
# - Never commit actual secrets to version control
# - Rotate regularly in production
# - Store in secure secret management system or Docker secrets
# - If compromised, all user sessions will be invalidated
# Generate a secure secret: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production


# ========================================
# MongoDB Connection Configuration
# ========================================

# Primary MongoDB connection
# SECURITY WARNING: In production, use authenticated connection with credentials
# Format: mongodb://username:password@host:port/database?authSource=database
# For Docker: mongodb://meriter_user:${MONGO_APP_PASSWORD}@mongodb:27017/meriter?authSource=meriter
# Default: mongodb://127.0.0.1:27017/meriter (NO AUTH - DEVELOPMENT ONLY)
# 
# IMPORTANT: Never commit actual passwords to version control
# Use environment variables from secure secret management
# For Docker Compose, use: mongodb://meriter_user:${MONGO_APP_PASSWORD}@mongodb:27017/meriter?authSource=meriter
MONGO_URL=mongodb://127.0.0.1:27017/meriter

# MongoDB admin user password (for initial database setup)
# Used only during first initialization to create admin user
# SECURITY: This is a sensitive value - never commit to version control
# Generate with: openssl rand -base64 32
MONGO_ADMIN_PASSWORD=your-strong-admin-password-here

# MongoDB application user password (for meriter_user)
# Used during first initialization and for API connections
# SECURITY: This is a sensitive value - never commit to version control
# Generate with: openssl rand -base64 32
# This password is used in MONGO_URL connection string
MONGO_APP_PASSWORD=your-strong-app-password-here


# ========================================
# Telegram Bot Configuration (OPTIONAL)
# ========================================

# Enable Telegram bot functionality (notifications, message reading, webhooks)
# Set to 'true' to enable Telegram bot features
# Default: false (disabled)
# When disabled, all Telegram bot functionality is completely disabled
TELEGRAM_BOT_ENABLED=false

# Bot token for Telegram API (OPTIONAL - get from @BotFather)
# SECURITY WARNING: This is a sensitive credential - never commit to version control
# Used for:
# - Bot community features (publications, hashtags, group management)
# - Telegram Web Auth verification (hash validation)
# Store in secure secret management system or Docker secrets
# If not set, Telegram bot features will be disabled
BOT_TOKEN=

# Bot username (without @) (OPTIONAL)
# Used for Telegram Login Widget on the web frontend
# If not set, Telegram bot features will be disabled
BOT_USERNAME=meriter_pro_bot

# Telegram API URL (defaults to official API)
# TELEGRAM_API_URL=https://api.telegram.org


# ========================================
# Special Chat IDs
# ========================================

# Banned chat ID (messages from this chat are ignored)
# BANNED_CHAT_ID=-1001765280630


# ========================================
# S3/Object Storage Configuration (OPTIONAL)
# ========================================

# S3-compatible storage credentials for image uploads and avatar caching
# If not set, avatar/image upload features will be disabled
# Service: Mail.ru Cloud S3, AWS S3, MinIO, or any S3-compatible storage
#
# SECURITY WARNING: S3 credentials are sensitive
# - Never commit actual credentials to version control
# - Use IAM roles when possible (AWS)
# - Rotate access keys regularly
# - Store in secure secret management system

# ========================================
# Local Development with MinIO (Docker Compose)
# ========================================
# When using docker-compose.local.yml, MinIO is automatically started
# Use these settings to connect to the local MinIO instance:
#
# S3_ENDPOINT=http://minio:9000
# S3_BUCKET_NAME=meriter
# S3_ACCESS_KEY_ID=minioadmin
# S3_SECRET_ACCESS_KEY=minioadmin
# S3_REGION=us-east-1
#
# MinIO Console: http://localhost:9001
# MinIO API: http://localhost:9000
# Default credentials: minioadmin / minioadmin
#
# NOTE: For local development without Docker, use:
# S3_ENDPOINT=http://localhost:9000
#
# IMPORTANT: Change MinIO credentials in production or shared environments!

# ========================================
# Production S3 Configuration
# ========================================
# For production, use real S3 or properly secured MinIO:
#
# S3_BUCKET_NAME=your-bucket-name
# S3_ACCESS_KEY_ID=your_access_key
# S3_SECRET_ACCESS_KEY=your_secret_key
# S3_ENDPOINT=https://hb.bizmrg.com  # or your S3 endpoint
# S3_REGION=ru-msk  # or your region
#
# S3_BUCKET_NAME is required when S3_ENDPOINT is set.


# ========================================
# Test Mode Flags (used in Jest tests)
# ========================================

# Disable external API calls in tests
# noAxios=true

# Mock admin privileges in tests
# admin=true


# ========================================
# Feature Flags
# ========================================

# Enable comment voting (set to 'true' to enable)
# When disabled, users can only vote on posts/publications, not on comments
# Default: false (comment voting disabled)
ENABLE_COMMENT_VOTING=false

# Enable image uploads in votes and comments (set to 'true' to enable)
# When disabled, users cannot attach images to votes or comments
# Default: false (image uploads disabled)
ENABLE_COMMENT_IMAGE_UPLOADS=false

# Enable Telegram authentication (widget and Web App auth)
# Set to 'true' to enable Telegram OAuth authentication
# Default: false (disabled)
# When disabled, Telegram authentication endpoints are not registered
OAUTH_TELEGRAM_ENABLED=false

# ========================================
# Development Mode Flags
# ========================================

# Enable fake data mode for local development (bypasses Telegram authentication)
# Set to 'true' to enable fake authentication and data generation
# WARNING: Only enable in local development, never in production
FAKE_DATA_MODE=true
TEST_AUTH_MODE=true

# ========================================
# Sentry Configuration
# ========================================

# Sentry DSN (Data Source Name) for error tracking and performance monitoring
# Get this from your Sentry project settings
# If not set, Sentry will be disabled (optional)
SENTRY_DSN=

# Sentry environment (development, staging, production)
# Defaults to NODE_ENV if not set
SENTRY_ENVIRONMENT=development

# Sentry performance monitoring sample rate (0.0 to 1.0)
# 1.0 = 100% of transactions are sampled
# Adjust based on traffic volume (lower for high-traffic production)
SENTRY_TRACES_SAMPLE_RATE=1.0

# Sentry profiling sample rate (0.0 to 1.0)
# Requires @sentry/profiling-node package (optional)
# 1.0 = 100% of transactions are profiled
SENTRY_PROFILES_SAMPLE_RATE=1.0

# Sentry tRPC middleware: attach RPC input to error events
# true: Attaches tRPC input to error events (useful for debugging, but may expose sensitive data)
# false: Only attaches procedure path/name (safer default, recommended for production)
# Default: false
SENTRY_TRPC_ATTACH_INPUT=false


# ========================================
# SMS Authentication Configuration
# ========================================

# Enable SMS authentication
SMS_ENABLED=false

# SMS provider (smsru, twilio, vonage, smsc, smsaero)
# Default: smsru (SMS.ru - recommended for Russia)
SMS_PROVIDER=smsru

# --- SMS.ru Configuration ---
# SMS.ru API base URL
# Default: https://sms.ru
SMSRU_API_URL=https://sms.ru

# Get your API ID from: https://sms.ru/panel/api/settings
# Free trial: 30 days + 5 free SMS/day to own number
SMSRU_API_ID=your_api_id_here

# Sender name (up to 11 Latin characters or 15 digits)
# Default: \"Meriter\"
SMSRU_FROM=Meriter

# Test mode (set to 'true' to enable)
# In test mode, SMS are not actually sent but API returns success
# Automatically enabled in development (NODE_ENV !== 'production')
# SMSRU_TEST_MODE=true

# --- Twilio Configuration (if using Twilio) ---
# TWILIO_ACCOUNT_SID=your_account_sid
# TWILIO_AUTH_TOKEN=your_auth_token
# TWILIO_PHONE_NUMBER=+1234567890
