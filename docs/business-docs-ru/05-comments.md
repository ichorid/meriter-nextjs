# 05. Комментарии

> Основной метод взаимодействия пользователя с постами.

---

## Типы комментариев

### Позитивный комментарий (Upvote)
- Мериты с кошелька пользователя переводятся на пост
- Рейтинг поста **растёт**
- Автор поста сможет снять эти мериты

### Нейтральный комментарий
- Только текст, без меритов
- Рейтинг поста **не меняется**
- Бесплатный (fee за комментарий всё равно взимается)

### Негативный комментарий (Downvote)
- Мериты с кошелька пользователя снимают мериты с поста
- Рейтинг поста **падает**
- Мериты сгорают (не переходят никому)

---

## Данные комментария

| Поле | Описание |
|------|----------|
| Вес | Сколько меритов комментарий принёс/отнял (0 для нейтральных) |
| Тело | Текст комментария |
| Автор | Пользователь-автор |
| Дата публикации | Timestamp создания |
| Прямая ссылка | URL для шаринга |

---

## Стоимость комментирования

### Fee за комментарий
- По умолчанию: **0.1 мерита**
- Оплачивается **глобальными** меритами (не меритами сообщества)
- Мериты **сгорают** (не переходят никому)
- Настраивается для каждого сообщества

### Что оплачивается
- Fee оплачивает право оставить комментарий
- Вес комментария (мериты на пост) — это отдельная трата

**Пример:**
1. Пользователь хочет оставить позитивный комментарий на 10 меритов
2. Списывается: 0.1 мерита fee + 10 меритов на пост = 10.1 мерита
3. Fee (0.1) сгорает, 10 меритов идут на рейтинг поста

---

## Правила голосования

### Источники оплаты

| Действие | Источник | Приоритет |
|----------|----------|-----------|
| Upvote чужого поста | Квота → Wallet | Сначала квота |
| Downvote любого поста | Только Wallet | — |
| Vote за свой пост | Только Wallet | Квотой нельзя |
| Vote за пост тиммейта | Настраивается | По умолчанию как за чужой |

### Ограничения по типам постов

| Тип поста | Позитивные | Негативные | Нейтральные |
|-----------|------------|------------|-------------|
| Базовый пост | ✅ | ✅ | ✅ |
| Опрос | ❌ | ❌ | ✅ |

### Голосование за свои посты
- По умолчанию **запрещено**
- Может быть разрешено в настройках сообщества
- Если разрешено — только из wallet, не из квоты

### Голосование за посты тиммейтов
Тиммейты — участники тех же локальных сообществ, что и голосующий.

- По умолчанию: меритами можно, квотой только за «чужих» (не из своих локальных)
- Настраивается для каждого сообщества

---

## Workflow комментария

```
┌─────────────────────────────────────────────────────────┐
│ Пользователь выбирает тип комментария                   │
├───────────────┬───────────────┬─────────────────────────┤
│   Позитивный  │   Нейтральный │      Негативный         │
└───────┬───────┴───────┬───────┴────────────┬────────────┘
        │               │                    │
        ▼               ▼                    ▼
┌───────────────┐ ┌───────────────┐ ┌───────────────────────┐
│ Выбор веса    │ │ Ввод текста   │ │ Выбор веса            │
│ (1+ меритов)  │ │               │ │ (1+ меритов)          │
└───────┬───────┘ └───────┬───────┘ └───────────┬───────────┘
        │               │                    │
        ▼               ▼                    ▼
┌─────────────────────────────────────────────────────────┐
│ Проверка баланса (wallet/квота достаточны?)             │
└───────────────────────────┬─────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│ Списание fee (0.1 глобальных меритов)                   │
└───────────────────────────┬─────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        ▼                   ▼                   ▼
┌───────────────┐ ┌───────────────┐ ┌───────────────────────┐
│ Перевод на    │ │ Ничего        │ │ Снятие с поста        │
│ рейтинг поста │ │               │ │ (мериты сгорают)      │
└───────────────┘ └───────────────┘ └───────────────────────┘
```

---

## Будущие фичи

### Комментарии на комментарии
- Комменты на комменты будут работать так же, как комменты на пост
- У комментариев появится их собственный рейтинг в меритах
- Можно будет снимать мериты со своих комментариев

### Снятие меритов с комментариев
- Можно ли снимать со своего заплюсованного комментария мериты — требует проработки
- Если комментарий загнали в минус — применяются те же правила, что для постов (списание через 24 часа)
