---
description: Core terminology and concepts for Meriter platform. Reference when implementing any feature.
globs:
  - "**/*.ts"
  - "**/*.tsx"
alwaysApply: false
---

# Meriter Business Glossary

> Reference this file to understand core concepts before implementing any feature.

## Platform Overview

**Meriter** — merit-based social platform where users earn and spend "merits" (internal currency) to promote their ideas and projects.

**Current Status:** MVP "Marathon of Good" — gamified platform for schoolchildren doing good deeds.

**Key Principle:** The more merits you have earned for the community, the higher your trust level, the easier it is to get support from community members.

---

## Core Concepts

### Merit
Unit of reputation/currency within a community.

**Properties:**
- Numeric, can have fractional part (1 merit, 1.5 merits)
- Community-specific: each community has its own merits
- **EXCEPTION:** All global communities share the SAME merit (meta-community Meriter)
- Each user individually accumulates and spends their merits

### Quota
Daily "burnable" merits. Auto-credited to a separate account, unused quota expires.

**Rules:**
- NOT mixed with main wallet
- Amount CANNOT exceed single credit amount — excess burns
- System fees (post, poll, forward) are paid from global wallet; exception: post creation may be paid from quota first when community setting `canPayPostFromQuota` is true, then wallet
- When both quota and wallet can be used for an action — quota is spent FIRST

### Wallet
Accumulated merits of a user in a specific community. Unlike quota — does NOT expire, accumulates.

### Fee (Commission)
System commission for an action (publishing, commenting). Merits are BURNED — not transferred to anyone.

### Effective Beneficiary
User who receives merits from withdrawal (and is allowed to withdraw). For a publication: `publication.beneficiaryId` if set, otherwise the author. Used in permission and withdrawal logic.

### Poll
Separate entity from Publication (own collection `polls`). Has question, options, expiresAt; voting spends merits (weight = amount). No "rating" on poll; neutral votes only. Creation cost: `settings.pollCost`.

### Post Type
Publication has `postType`: `'basic' | 'poll' | 'project'`. Used for forwarding and display. (Standalone Poll entity is separate from publications.)

### Permission Rules
Community configuration: `permissionRules` — role → action → allow/deny, with optional conditions (e.g. `canVoteForOwnPosts`). Controls who can publish, vote, edit, etc. Replaces legacy toggles like canPublish, whoCanVote.

### Edit Window
Time after publication during which the author (or others if `allowEditByOthers`) can edit. **In code:** `settings.editWindowMinutes` (0 = no limit); overridable per rule via `permissionRules[].conditions.canEditAfterMinutes`.

---

## Rating Concepts

### Post Rating
Sum of merits "attached" to a post through comments (votes). Can be positive or negative.

**In code:** Stored as `publication.metrics.score`.

### Maximum Rating (lifetimeCredits)
Total merits ever credited to a post throughout history (votes, author top-up, tappalka wins). Never decreased.

**In code:** Stored as `publication.lifetimeCredits`.

### Rates (Multipliers)
Merit multipliers for specific communities or content types (e.g. ×2, ×0.1, ×10).

**Status:** Planned only. No `rateMultiplier` field in community schema and no runtime multiplier application in current codebase.

---

## Community Types

### Global Community (Public Group)
Community created by platform administration.

**Properties:**
- All users are members by default (immediately after registration)
- Share ONE common merit between themselves
- Merits earned in one global community can be spent in another global community
- User CANNOT leave a global community
- List of global communities can expand

### Local Community (Private Group)
Community created and managed by users.

**Properties:**
- Has its OWN merit (separate from global)
- Full set of settings available to lead
- User can be member of ANY number of local communities
- User can be lead of ANY number of communities
- User can voluntarily leave any local community
- Lead CANNOT delete community — only request deletion from administration (dedicated "request deletion" API is not implemented in current codebase)

### Lead
Administrator of a local community (creator or appointed). Has access to community settings.

---

## Actions

### Post Forwarding
Moving a post from one community to another.

**Two modes (source community `settings.forwardRule`):**
- **standard** — copy without merits, original preserved (DEFAULT)
- **project** — transfer with merits, original deleted

**In code:** `community.settings.forwardRule`: `'standard' | 'project'`.

### Merit Withdrawal
Transferring merits from post rating to the effective beneficiary's wallet. Post rating (`metrics.score`) decreases.

**Effective beneficiary:** `publication.beneficiaryId` if set, otherwise the author. Only the effective beneficiary may withdraw; they receive the merits.

### Post Closing
Post is moved to archive (removed from feed). Closed post CANNOT be re-published.

**In code:** `publication.status`: `'active' | 'closed'`; `closeReason`: `'manual' | 'ttl' | 'inactive' | 'negative_rating'`; optional `closingSummary` with distribution totals.

---

## Mechanics

### Tappalka
Mechanism for comparing two posts for merit emission. User sees two posts, chooses better one — chosen post receives merit (emission).

### Emission
Creation of new merits by the system. Happens through tappalka, from administration, or as welcome merits at registration.

**Welcome merits:** Amount from platform setting `welcomeMeritsGlobal` (PlatformSettings); credited to global wallet at registration.

### Stop-Loss
Minimum rating/merit threshold below which post stops being shown in tappalka. Set by post owner.

**In code:** `publication.stopLoss`.

### Investment Pool
Post-level balance funded by investors. Used first for tappalka show-cost deductions in investment mode.

### Investment Contract
Immutable agreement created at post publication when investing is enabled. Defines `investorSharePercent` (within community `settings.investorShareMin`..`settings.investorShareMax`) and distribution rules between author and investors.

**In code:** `publication.investorSharePercent`; bounds in `community.settings.investorShareMin` / `investorShareMax`.

### Investor Share
Portion of withdrawal/close distribution allocated to investors according to contract percent, then split proportionally by each investor's contribution.

### TTL (Time To Live)
Post lifetime limit in days. For investment posts, TTL may be required by community setting `requireTTLForInvestPosts` and capped by `maxTTL`.

**In code:** `publication.ttlDays` (e.g. 7, 14, 30, 60, 90), `publication.ttlExpiresAt`; community: `settings.requireTTLForInvestPosts`, `settings.maxTTL`.

### Inactive Close
Automatic post closing after configured days without earnings (`inactiveCloseDays`).

### Comment (Vote) Withdrawal
Withdrawal of merits from one's own comment (vote) to the voter's wallet. **In code:** `votes.withdrawFromVote`; same effective-beneficiary and balance rules as for post withdrawal.

### noAuthorWalletSpend
Publication-level flag. When true, tappalka show-cost is NOT taken from the author's wallet; only investment pool and post rating are used. Post exits tappalka when pool and rating (down to stop-loss) are exhausted.

---

## MVP-Specific Terms

| Universal Term | MVP Term |
|----------------|----------|
| Local community | Team group |
| Lead of local community | Team lead |
| Global community | Public group |

### "Image of Future" (ОБ / Obraz Budushchego)
Global community for publishing visions of ideal future. Main game community in "Marathon of Good".

### "Marathon of Good" (МД / Marafon Dobra)
Global community for reports on actually done good deeds. Main source of merit earning.

### Team Group
Local community in MVP context. Created by participants to unite like-minded people.
