---
description: Master context file for Meriter project. Always include this for any code changes.
globs:
  - "**/*"
alwaysApply: true
---

# Meriter Project Context

## What is Meriter?
Merit-based social platform operating through web. Users earn and spend "merits" (internal currency) to participate in community activities: create publications, vote for content creators, comment, and participate in polls.

## Tech Stack
- **Frontend**: React 19 + Next.js 16 + TypeScript + TanStack Query + tRPC + Tailwind + Zustand
- **Backend**: NestJS + TypeScript + tRPC + REST API
- **Database**: MongoDB 8 + Mongoose
- **Infrastructure**: pnpm monorepo, Docker Compose, Caddy reverse proxy, AWS S3/MinIO

## Repository Structure
```
meriter-nextjs/
├── api/                          # Backend (NestJS)
│   └── apps/meriter/src/
│       ├── domain/               # Domain entities and services
│       ├── trpc/routers/         # tRPC routers
│       ├── common/schemas/       # Shared backend schemas
│       └── api-v1/               # REST endpoints
├── web/                          # Frontend (Next.js)
│   └── src/
│       ├── app/                  # Next.js app router
│       ├── components/           # UI components
│       ├── features/             # Feature modules
│       ├── hooks/                # Custom hooks
│       ├── stores/               # Zustand stores
│       └── lib/                  # Utilities
├── libs/shared-types/            # Shared Zod schemas
└── docs/                         # Documentation (.md files in root)
```

## Core Concepts
- **Merit**: Unit of reputation/currency within a community or several communities
- **Community**: Group created by users or administrators
- **Publication**: Content that can receive votes
- **Quota**: Daily free merits for voting (refreshes daily)
- **Wallet**: Accumulated merits in a community

## Key Patterns

### API Calls
- **Authenticated requests**: TanStack Query + tRPC
- **Unauthenticated requests**: TanStack Query + REST
- **Image uploads**: TanStack Query + REST with auth

### Schema Location
- Shared schemas: `libs/shared-types/src/`
- Backend-only schemas: `api/apps/meriter/src/common/schemas/`

### Naming Conventions
- Routes: `getById`, `getAll`, `create`, `update`, `delete`
- Files: kebab-case for files, PascalCase for components
- Variables: camelCase

## Before Making Changes
1. Check existing patterns in similar files
2. Use shared schemas when shape is reused
3. Run `pnpm lint` before committing
4. Update both frontend AND backend when changing contracts

## Related Rules
- @business-logic.mdc — Voting rules, permissions, merit flow
- @architecture.mdc — Detailed code structure
- @frontend.mdc — React/Next.js patterns
- @backend.mdc — NestJS/tRPC patterns